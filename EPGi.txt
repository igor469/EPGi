Проект "EPGi". (Версия 08.08.25)

Оглавление
1. Основная цель проекта
2. Структура проекта
3. Ограничения и допущения проекта
4. Структура, состав входного файла параметров EPGi.ini
5. Представление выходной информации, принципы перемещения по ней
6. Файл журнала (EPGi.log)
7. Логика работы результирующей программы 

1. Основная цель проекта
Основная цель проекта - реализация консольной (CLI) программы на Python, которая предоставляет пользователю интерактивные средства просмотра актуальной программ передач каналов IPTV от нескольких поставщиков EPG.

2. Структура проекта
Структура проекта -
EPGi/
├── EPGi.py           ← основная программа
├── EPGi.ini          ← файл параметров
├── EPGi.log          ← файл журнала-протокола работы программы 
└── README.md

3. Ограничения и допущения проекта
Файлы EPG представлены в структуре XML.
Структура и состав атрибутов файлов EPG у разных поставщиков EPG отличаются.
Файлы EPG может быть архивированы.
Количество поставщиков EPG: 1-9.
Количество каналов IPTV в одном файле EPG: 1 - 10000.
Количество дней программы передач для одного канала: 1 - 14.

4. Структура, состав входного файла параметров EPGi.ini
В файле параметров EPGi.ini пользователем указываются следующие параметры:
col1 - основной цвет вывода информации на экран (цвет текста, цвет фона)
col2 - цвет вывода текущей строки в табличных формах
col3 - цвет вывода атрибутов дата, время передачи, которая завершилась 
col4 - цвет вывода информации в статусной строке
urlN - http ссылка на актуальный файл EPG от N-го поставщика (N=1-9). 
tz	 - часовой пояс (IANA). Пусто = системный
locale - локаль для названий месяцев/дней (если установлена в системе)
date_fmt - формат дат    (%d.%m)
time_fmt - формат времен (%H:%M)
Далее приведен реальный файл EPGi.ini
-----
[DEFAULT]
# Цветовые пары: COLOR_<NAME>,COLOR_<NAME>
col1=COLOR_WHITE,COLOR_BLACK
col2=COLOR_BLACK,COLOR_WHITE
col3=COLOR_RED,COLOR_BLACK
col4=COLOR_GREEN,COLOR_BLACK
# Ссылки на EPG (1..9). Пустые строки игнорируются.
url1=http://epg.one/epg.xml.gz
url2=http://epg.online/epg.xml.gz
url3=http://1lot.tv/epg/epg.xml
url4=http://epg.ott-play.com/edem/edem.xml.gz
url5=http://epg.ott-play.com/ottg/epg.xml.gz
url6=http://epg.ott-play.com/only4/epg.xml.gz
url7=
url8=
url9=
# Часовой пояс (IANA). Пусто = системный
tz=Europe/Kyiv
# Локаль для названий месяцев/дней (если установлена в системе)
locale=ru_RU.UTF-8
# Форматы даты/времени
date_fmt=%d.%m
time_fmt=%H:%M
-----

5. Представление выходной информации, принципы перемещения по ней
Информация выдается в чисто табличной форме, за одним исключением (э4).
Заголовки (шапки) всех таблиц не выводятся.
Количество строк при выводе определяется размерами экрана (окна).
Колонки имеют фиксированную ширину. 
Остаток информации, который не помещается в колонку отсекается (обрезается).
Все колонки разделяются пробелом.
По ширине формы ограничены шириной экрана.
Строки выводятся цветом указанным в параметре col1 из EPGi.ini
Текущая (активная) строка выводятся цветом указанным в параметре col2 из EPGi.ini
Действия и перемещения по всем табличным формам (стандартные):
- стрелочками "вверх", "вниз" - перемещение текущей (активной) строки на 1 позицию
- PageUp, PageDown - постраничное перемещение по таблице
- Home, End - перемещение в начало, конец таблицы

6. Файл журнала (EPGi.log)
В файл журнала (EPGi.log) выводится следующая информация:
- время старта программы
- все ошибки работы
Времена в сообщениях выводятся в формате - чч:мм:сс
Каждая строка журнала имеет структуру - 2025-07-10 14:23:27: Сообщение...
Файл журнала дописывается а не удаляется при каждом запуске программы

7. Логика работы результирующей программы
Вначале считывается и обрабатывается файл параметров EPGi.ini.
Затем происходит интерактивный процес предоставления информации пользователю нескольких рабочих экранах по которым и между которыми он перемещается.

Считывание и обработка файла EPG могут занимать значительное время. Поэтому его считывание и обработка выполняется один раз - при необходимости вывода информации из него. 
Если пользователь не обращается к информации какого то EPG то она и не считывается.
Если пользователь повторно обращается к информации какого то EPG то она повторно не считывается, а берется из сохраненной его информации, полученной при первом обращении.

Первый экран (э1) - таблица из 2 колонок на экране, где:
1 колонка: номер поставщика EPG одна цифра (1-9)
2 колонка: urlN (http ссылка на файл EPG этого поставщика)
Количество строк - это количество поставщиков EPG из EPGi.ini
Т е каждая строка это информация об одном поставщике EPG из EPGi.ini
Действия и перемещения по э1, кроме стандартных для табличных форм:
- стрелочкой "вправо" - переход на экран 2 (э2)
- стрелочкой "влево" или Esc - завершение работы программы

Второй экран (э2) - таблица из 4 колонок, где:
1 колонка: наименование канала (20 символов)
2 колонка: наименование текущей передачи. Ширина колонки 2 определяется таким образом, что бы таблица занимала всю ширину экрана.
3 колонка: число от 0 до 100, показывающее % времени прошедший с начала передачи (4 символа)
4 колонка: графический индикатор (10 символов), показывающий % времени прошедший с начала передачи. Элементами индикатора является "прямоугольник" (из псевдографики) и символ пробела.
Таблица отсортирована по наименованию канала.
Каждая строка это информация о канале с актуальной (текущей) передачей идущей сейчас на нем.
Действия и перемещения по э2, кроме стандартных для табличных форм:
- стрелочкой "вправо" - переход на экран 3 (э3)
- стрелочкой "влево" или Esc - переход на экран 1 (э1)
- Enter - вывод экрана 4 (э4)
- F - задание условия фильтра по по названию канала
- C - сброс (очистка) текущего значения фильтра
Верхняя строка э2 используется как статусная. 
В ней выводится и задается условие фильтра (по названию канала), количество строк удовлетворяющих текущему условию фильтра и общее число строк, информация об действующих клавишах навигации и заданию фильтра или его сброса (очистке).
Пример статусной строки
-----
[F]ilter: 'UHD'  49/1857  (Enter=э4, →=э3, Esc/←=назад, C=clear filter)
-----

Третий экран (э3) - таблица из 3 колонок, где:
1 колонка: дата передачи в формате дд:мм (5 символов)
2 колонка: время начала передачи в формате чч:мм (5 символов)
3 колонка: наименование передачи
Значения атрибутов дата и время для передач, которые завершились выводятся цветом указанным в параметре col3 из EPGi.ini
Последовательность строк э3 - это последовательность (во времени) передач текущего канала.
Т е таблица отсортирована по дате и времени передач.
Каждая строка это информация о передаче идущей в указаною дату + время.
При входе в э3: 
1 строка - предыдущая программа канала
2 строка - текущая программа канала
3 строка - следующая программа канала
...
Действия и перемещения по э3, кроме стандартных для табличных форм:
- стрелочкой "влево" или Esc - переход на э2 в тоже строку
- стрелочкой "вправо" или Enter - вывод экрана 4 (э4)

Четвертый экран (э4) - форма (не табличная) в которой выводится идентификаторы всех атрибутов и их значения из файла EPG для текущего канала и передачи.
Конкретный состав атрибутов, их идентификаторы определяются конкретным файлом EPG поставщика и отличаются у разных поставщиков.
Вывод осуществляется парами идентификатор атрибута - его значение.
Информация не обрезается и при "не влезании" по ширине - продолжается на следующей строке.
Некоторые атрибуты могут иметь несколько значений (список). Они выводятся все с использованием разделителя ","
Если информация не помещается в один экран то возможно постраничное листание клавишами PageUp и PageDown.
По клавишам стрелочка "влево" или Esc - выполняется возврат на предыдущий экран (э2 или э3) в тоже строку.
